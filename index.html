<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arca do Conhecimento | Jogo Educativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        #name-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            outline: none;
        }
        .letter-card { transition: all 0.3s ease; }
        .letter-card:hover { transform: translateY(-5px); }
        /* Estilo para s√≠laba inicial destacada */
        .highlight-syllable { color: #dc2626 !important; font-weight: 900; text-shadow: 0 2px 4px rgba(220, 38, 38, 0.3); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .syllable-card { transition: all 0.3s ease; cursor: pointer; }
        .syllable-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .ranking-item { transition: all 0.3s ease; }
        .ranking-item:hover { transform: translateX(5px); background-color: #fef3c7; }
        .speaker-icon { transition: all 0.3s ease; }
        .syllable-card:hover .speaker-icon { transform: scale(1.2); color: #4f46e5; }
        .playing { animation: bounce 0.5s ease infinite; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .word-example { cursor: pointer; transition: all 0.3s ease; }
        .word-example:hover { background-color: #c7d2fe !important; transform: scale(1.05); }
        .word-example.playing { background-color: #a5b4fc !important; border-color: #4f46e5 !important; }
        /* Drag & Drop Styles */
        .puzzle-letter { transition: all 0.3s ease; cursor: grab; user-select: none; touch-action: none; }
        .puzzle-letter:active { cursor: grabbing; transform: scale(1.1); z-index: 10; }
        .puzzle-slot { transition: all 0.3s ease; min-height: 70px; }
        .puzzle-slot.highlight { background-color: #dbeafe; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); }
        .puzzle-slot.correct { background-color: #dcfce7; border-color: #16a34a; }
        .puzzle-letter.correct { background-color: #bbf7d0 !important; border-color: #16a34a !important; cursor: default; }
        .puzzle-letter.placed { cursor: default; }
        .puzzle-hint { transition: all 0.3s ease; cursor: pointer; }
        .puzzle-hint:hover { transform: scale(1.1); background-color: #fef3c7; }
        .shake { animation: shake 0.5s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .syllable-slot.correct { background-color: #dcfce7; border-color: #16a34a; }

        /* --- ESTILOS PARA JOGO DA MEM√ìRIA --- */
        #memory-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 colunas */
            gap: 16px;
            justify-content: center;
        }
        .memory-card {
            perspective: 1000px;
            height: 120px;
            width: 100%;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .memory-card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 3px solid;
        }
        .card-back {
            background-color: #06b6d4; /* Teal */
            color: white;
            transform: rotateY(0deg);
            border-color: #0e7490;
            font-size: 40px;
        }
        .card-front {
            background-color: #f0fdfa; /* Teal-50 */
            color: #1f2937;
            transform: rotateY(180deg);
            border-color: #99f6e4;
            font-size: 32px;
            padding: 8px;
            flex-direction: column; 
            line-height: 1.2;
        }
        .memory-card.matched .card-front {
            background-color: #ccfbf1; /* Teal-200 */
            border-color: #14b8a6; /* Teal-500 */
            cursor: default;
        }
        @media (max-width: 640px) {
            #memory-board {
                grid-template-columns: repeat(3, 1fr); /* 3 cards per row on small screens */
                gap: 10px;
            }
            .memory-card {
                height: 100px;
            }
            .card-back {
                font-size: 30px;
            }
            .card-front {
                font-size: 20px;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

    <div id="app" class="bg-white shadow-2xl rounded-3xl p-6 sm:p-10 w-full max-w-4xl border-4 border-yellow-500 transition-all duration-300">
    </div>

    <script>
        // --- DADOS DO JOGO (EM PORTUGU√äS) ---
        const ALPHABET_DATA = [
            { letter: 'A', word: 'ABELHA', emoji: 'üêù', syllables: ['A', 'BE', 'LHA'] },
            { letter: 'B', word: 'BOLA', emoji: '‚öΩ', syllables: ['BO', 'LA'] },
            { letter: 'C', word: 'CASA', emoji: 'üè†', syllables: ['CA', 'SA'] },
            { letter: 'D', word: 'DADO', emoji: 'üé≤', syllables: ['DA', 'DO'] },
            { letter: 'E', word: 'ESTRELA', emoji: '‚≠ê', syllables: ['ES', 'TRE', 'LA'] },
            { letter: 'F', word: 'FOCA', emoji: 'ü¶≠', syllables: ['FO', 'CA'] },
            { letter: 'G', word: 'GATO', emoji: 'üêà', syllables: ['GA', 'TO'] },
            { letter: 'H', word: 'HARPA', emoji: 'üé∂', syllables: ['HAR', 'PA'] },
            { letter: 'I', word: 'IGREJA', emoji: '‚õ™', syllables: ['I', 'GRE', 'JA'] },
            { letter: 'J', word: 'JANELA', emoji: 'üñºÔ∏è', syllables: ['JA', 'NE', 'LA'] },
            { letter: 'L', word: 'LIVRO', emoji: 'üìñ', syllables: ['LI', 'VRO'] },
            { letter: 'M', word: 'MACACO', emoji: 'üêí', syllables: ['MA', 'CA', 'CO'] },
            { letter: 'N', word: 'NAVIO', emoji: 'üö¢', syllables: ['NA', 'VIO'] },
            { letter: 'O', word: 'OVELHA', emoji: 'üêë', syllables: ['O', 'VE', 'LHA'] },
            { letter: 'P', word: 'PATO', emoji: 'ü¶Ü', syllables: ['PA', 'TO'] },
            { letter: 'Q', word: 'QUEIJO', emoji: 'üßÄ', syllables: ['QUEI', 'JO'] },
            { letter: 'R', word: 'RATO', emoji: 'üê≠', syllables: ['RA', 'TO'] },
            { letter: 'S', word: 'SAPO', emoji: 'üê∏', syllables: ['SA', 'PO'] },
            { letter: 'T', word: 'TATU', emoji: 'ü¶î', syllables: ['TA', 'TU'] },
            { letter: 'U', word: 'UVA', emoji: 'üçá', syllables: ['U', 'VA'] },
            { letter: 'V', word: 'VACA', emoji: 'üêÑ', syllables: ['VA', 'CA'] },
            { letter: 'X', word: 'X√çCARA', emoji: '‚òï', syllables: ['X√ç', 'CA', 'RA'] },
            { letter: 'Z', word: 'ZEBRA', emoji: 'ü¶ì', syllables: ['ZE', 'BRA'] },
        ];
        // Dados completos de todas as s√≠labas organizadas por consoante
        const ALL_SYLLABLES_DATA = [
            // Consoante B
            { syllable: 'Ba', words: ['BALA', 'BANANA', 'BATATA'], emoji: 'üçå' },
            { syllable: 'Be', words: ['BEB√ä', 'BEXIGA', 'BEN√á√ÉO'], emoji: 'üë∂' },
            { syllable: 'Bi', words: ['BICICLETA', 'BISCOITO', 'BICHO'], emoji: 'üö≤' },
            { syllable: 'Bo', words: ['BOLA', 'BONECA', 'BOCA'], emoji: '‚öΩ' },
            { syllable: 'Bu', words: ['BURACO', 'B√öSSOLA', 'B√öFALO'], emoji: 'üï≥Ô∏è' },
            
            // Consoante C
            { syllable: 'Ca', words: ['CASA', 'CACHORRO', 'CAMA'], emoji: 'üè†' },
            { syllable: 'Ce', words: ['C√âU', 'CEREJA', 'CENOURA'], emoji: 'üçí' },
            { syllable: 'Ci', words: ['CINCO', 'CIRCO', 'CIGARRA'], emoji: 'üé™' },
            { syllable: 'Co', words: ['COELHO', 'CORDA', 'COPO'], emoji: 'üêá' },
            { syllable: 'Cu', words: ['CUBO', 'CUPIM', 'CUSCUZ'], emoji: 'üé≤' },
            
            // Consoante D
            { syllable: 'Da', words: ['DADO', 'DAN√áA', 'DAMA'], emoji: 'üé≤' },
            { syllable: 'De', words: ['DENTE', 'DEDO', 'DEUS'], emoji: 'ü¶∑' },
            { syllable: 'Di', words: ['DINOSSAURO', 'DIA', 'DINHEIRO'], emoji: 'ü¶ñ' },
            { syllable: 'Do', words: ['DONZELA', 'DOR', 'DOCE'], emoji: 'üç¨' },
            { syllable: 'Du', words: ['DUCHA', 'DUENDE', 'DUNAS'], emoji: 'üßù' },
            
            // Consoante F
            { syllable: 'Fa', words: ['FADA', 'FACA', 'FAROL'], emoji: 'üßö' },
            { syllable: 'Fe', words: ['FESTA', 'FELIZ', 'FERRAMENTA'], emoji: 'üéâ' },
            { syllable: 'Fi', words: ['FILHO', 'FITA', 'FIM'], emoji: 'üë¶' },
            { syllable: 'Fo', words: ['FOGO', 'FOCA', 'FOLHA'], emoji: 'üî•' },
            { syllable: 'Fu', words: ['FURAC√ÉO', 'FUTURO', 'FUTEBOL'], emoji: 'üå™' },
            
            // Consoante G
            { syllable: 'Ga', words: ['GATO', 'GALINHA', 'GARFO'], emoji: 'üêà' },
            { syllable: 'Ge', words: ['GELO', 'GELADEIRA', 'GEMA'], emoji: 'üßä' },
            { syllable: 'Gi', words: ['GIRAFA', 'GIGANTE', 'GIN√ÅSIO'], emoji: 'ü¶í' },
            { syllable: 'Go', words: ['GOLFINHO', 'GOTA', 'GOL'], emoji: 'üê¨' },
            { syllable: 'Gu', words: ['GUITARRA', 'GUERRA', 'GUARDA'], emoji: 'üé∏' },

	        // Consoante H
            { syllable: 'Ha', words: ['HARMONIA', 'HABILIDADE', 'HARPA'], emoji: 'üéº' },
            { syllable: 'He', words: ['HER√ìI', 'HERDEIRO', 'HELICOPTERO'], emoji: 'üöÅ' },
            { syllable: 'Hi', words: ['HIST√ìRIA', 'HIGIENE', 'HINO'], emoji: 'üóø' },
            { syllable: 'Ho', words: ['HONRA', 'HOMENAGEM', 'HOMEM'], emoji: 'üë®‚Äçü¶∞' },
            { syllable: 'Hu', words: ['HUMILDADE', 'HUMANO', 'HUMOR'], emoji: 'üöπ' },

            
            // Consoante J
            { syllable: 'Ja', words: ['JANELA', 'JACAR√â', 'JARDIM'], emoji: 'üñºÔ∏è' },
            { syllable: 'Je', words: ['JESUS', 'JEGUE', 'JEITO'], emoji: 'üôè' },
            { syllable: 'Ji', words: ['JIPE', 'JIL√ì', 'JIBOIA'], emoji: 'üöô' },
            { syllable: 'Jo', words: ['JOELHO', 'JOGO', 'JORNAL'], emoji: 'ü¶µ' },
            { syllable: 'Ju', words: ['JUSTI√áA', 'J√öRI', 'JUJUBA'], emoji: '‚öñÔ∏è' },
            
            // Consoante L
            { syllable: 'La', words: ['L√ÅPIS', 'LAGO', 'LARANJA'], emoji: '‚úèÔ∏è' },
            { syllable: 'Le', words: ['LE√ÉO', 'LEITE', 'LEN√áO'], emoji: 'ü¶Å' },
            { syllable: 'Li', words: ['LIVRO', 'LIM√ÉO', 'LINHA'], emoji: 'üìñ' },
            { syllable: 'Lo', words: ['LOBO', 'LOU√áA', 'LONGE'], emoji: 'üê∫' },
            { syllable: 'Lu', words: ['LUA', 'LUZ', 'LUGAR'], emoji: 'üåô' },
            
            // Consoante M
            { syllable: 'Ma', words: ['MACACO', 'M√ÉO', 'MALA'], emoji: 'üêí' },
            { syllable: 'Me', words: ['MESA', 'MEDO', 'MENINO'], emoji: 'ü™ë' },
            { syllable: 'Mi', words: ['MILHO', 'MINHOCA', 'MICO'], emoji: 'üåΩ' },
            { syllable: 'Mo', words: ['MORANGO', 'MOEDA', 'MOLA'], emoji: 'üçì' },
            { syllable: 'Mu', words: ['MULHER', 'MUNDO', 'MURO'], emoji: 'üë©' },
            
            // Consoante N
            { syllable: 'Na', words: ['NAVIO', 'NARIZ', 'NADA'], emoji: 'üö¢' },
            { syllable: 'Ne', words: ['NEGRO', 'N√âVOA', 'NERVO'], emoji: 'üå´Ô∏è' },
            { syllable: 'Ni', words: ['NINHO', 'N√çQUEL', 'NINHO'], emoji: 'üê£' },
            { syllable: 'No', words: ['NOME', 'NOITE', 'N√ì'], emoji: 'üåô' },
            { syllable: 'Nu', words: ['NUVEM', 'N√öMERO', 'NUBLADO'], emoji: '‚òÅÔ∏è' },
            
            // Consoante P
            { syllable: 'Pa', words: ['PATO', 'P√ÉO', 'PALHA√áO'], emoji: 'ü¶Ü' },
            { syllable: 'Pe', words: ['PEIXE', 'PEDRA', 'PENA'], emoji: 'üêü' },
            { syllable: 'Pi', words: ['PIPA', 'PIR√ÇMIDE', 'PICOL√â'], emoji: 'ü™Å' },
            { syllable: 'Po', words: ['PORTA', 'POTE', 'POMBA'], emoji: 'üö™' },
            { syllable: 'Pu', words: ['PULGA', 'PULO', 'PULSO'], emoji: 'ü¶ó' },

           // Consoante Q (3 itens) - Com placeholders para a pr√≥xima p√°gina
            { syllable: 'Qua', words: ['QUANDO', 'QUALIDADE', 'QUANTIDADE'], emoji: '‚ûï' },
            { syllable: 'Que', words: ['QUEST√ÉO', 'QUERIDO', 'QUENTE'], emoji: 'ü§í' },
            { syllable: 'Qui', words: ['QUISER', 'QUIETO', 'QUINTAL'], emoji: 'üôá‚Äç‚ôÇÔ∏è' },
            { placeholder: true, syllable: '', words: [], emoji: '' },
            { placeholder: true, syllable: '', words: [], emoji: '' },

            
            // Consoante R
            { syllable: 'Ra', words: ['RATO', 'RABO', 'RADIO'], emoji: 'üê≠' },
            { syllable: 'Re', words: ['REI', 'RELOGIO', 'REDE'], emoji: 'üëë' },
            { syllable: 'Ri', words: ['RIO', 'RISO', 'RICO'], emoji: 'üåä' },
            { syllable: 'Ro', words: ['ROSA', 'RODA', 'ROUPA'], emoji: 'üåπ' },
            { syllable: 'Ru', words: ['RUA', 'RU√çDO', 'RUGIDO'], emoji: 'üõ£Ô∏è' },
            
            // Consoante S
            { syllable: 'Sa', words: ['SAPO', 'SAL', 'SACO'], emoji: 'üê∏' },
            { syllable: 'Se', words: ['SETE', 'SERRA', 'SELO'], emoji: '7Ô∏è‚É£' },
            { syllable: 'Si', words: ['SINO', 'SIRI', 'SIL√äNCIO'], emoji: 'üîî' },
            { syllable: 'So', words: ['SOL', 'SOMBRA', 'SORRISO'], emoji: '‚òÄÔ∏è' },
            { syllable: 'Su', words: ['SUCO', 'SURDO', 'SUOR'], emoji: 'üßÉ' },
            
            // Consoante T
            { syllable: 'Ta', words: ['TATU', 'TANQUE', 'TAMANHO'], emoji: 'ü¶î' },
            { syllable: 'Te', words: ['TESOURA', 'TERRA', 'TELA'], emoji: '‚úÇÔ∏è' },
            { syllable: 'Ti', words: ['TIGRE', 'TINTA', 'TIO'], emoji: 'üêØ' },
            { syllable: 'To', words: ['TOMATE', 'TOURO', 'TOALHA'], emoji: 'üçÖ' },
            { syllable: 'Tu', words: ['TUCANO', 'TUBAR√ÉO', 'T√öNEL'], emoji: 'ü¶ú' },
            
            // Consoante V
            { syllable: 'Va', words: ['VACA', 'VASSOURA', 'VASO'], emoji: 'üêÑ' },
            { syllable: 'Ve', words: ['VELA', 'VENTO', 'VER√ÉO'], emoji: 'üïØÔ∏è' },
            { syllable: 'Vi', words: ['VIOL√ÉO', 'VIDA', 'VILA'], emoji: 'üé∏' },
            { syllable: 'Vo', words: ['VOV√ì', 'VOLTA', 'VOO'], emoji: 'üëµ' },
            { syllable: 'Vu', words: ['VULC√ÉO', 'VULTO', 'VULGO'], emoji: 'üåã' },
            
            // Consoante X
            { syllable: 'Xa', words: ['XADREZ', 'XALE', 'XAROPE'], emoji: '‚ôüÔ∏è' },
            { syllable: 'Xe', words: ['XEQUE', 'XERIFE', 'XENOFOBIA'], emoji: 'üëÆ' },
            { syllable: 'Xi', words: ['X√çCARA', 'XILOFONE', 'XISTO'], emoji: '‚òï' },
            { syllable: 'Xo', words: ['XOXO', 'XOD√ì', 'XOTE'], emoji: 'üíï' },
            { syllable: 'Xu', words: ['XUXU', 'XURUPITA', 'XUCA'], emoji: 'üçà' },
            
            // Consoante Z
            { syllable: 'Za', words: ['ZEBRA', 'ZANG√ÉO', 'ZARPAR'], emoji: 'ü¶ì' },
            { syllable: 'Ze', words: ['ZELO', 'ZERO', 'ZEN'], emoji: '0Ô∏è‚É£' },
            { syllable: 'Zi', words: ['ZIGUEZAGUE', 'ZINCO', 'Z√çPER'], emoji: '„Ä∞Ô∏è' },
            { syllable: 'Zo', words: ['ZOOL√ìGICO', 'ZOMBAR', 'ZONA'], emoji: 'üêò' },
            { syllable: 'Zu', words: ['ZUMBIDO', 'ZUNIR', 'ZUNZUM'], emoji: 'üêù' }
        ];
        
        // --- M√ìDULO: JOGO DA MEM√ìRIA (Palavra + S√≠laba Inicial) ---
        const MEMORY_GAME_DATA_PAIRS = [
            // Pares Palavra e S√≠laba
            { word: 'BOLA', syllable: 'BO', emoji: '‚öΩ' },
            { word: 'CASA', syllable: 'CA', emoji: 'üè†' },
            { word: 'DADO', syllable: 'DA', emoji: 'üé≤' },
            { word: 'GATO', syllable: 'GA', emoji: 'üêà' },
            { word: 'PATO', syllable: 'PA', emoji: 'ü¶Ü' },
            { word: 'SAPO', syllable: 'SA', emoji: 'üê∏' },
            { word: 'FOCA', syllable: 'FO', emoji: 'ü¶≠' },
            { word: 'LUA', syllable: 'LU', emoji: 'üåô' },
        ];

        // --- M√ìDULO: QUEBRA-CABE√áA DE PALAVRAS (Letras Drag & Drop) ---
        const WORD_PUZZLES_DATA = [
            { word: 'GATO', emoji: 'üê±', hint: 'Animal que mia' },
            { word: 'CASA', emoji: 'üè†', hint: 'Lugar onde moramos' },
            { word: 'BOLA', emoji: '‚öΩ', hint: 'Objeto redondo para brincar' },
            { word: 'SAPO', emoji: 'üê∏', hint: 'Animal que salta e faz "ribbit"' },
            { word: 'FLOR', emoji: 'üå∫', hint: 'Planta colorida e perfumada' },
        ];

        // --- M√ìDULO: FORMA√á√ÉO DE PALAVRAS (S√≠labas Click) ---
        const WORD_PUZZLES = [
            { word: 'GATO', segments: ['GA', 'TO'], type: 'S√çLABA' },
            { word: 'BOLA', segments: ['BO', 'LA'], type: 'S√çLABA' },
            { word: 'SAPO', segments: ['SA', 'PO'], type: 'S√çLABA' },
            { word: 'FOCA', segments: ['FO', 'CA'], type: 'S√çLABA' },
            { word: 'DADO', segments: ['DA', 'DO'], type: 'S√çLABA' },
        ];

        // --- M√ìDULO: CONTAGEM ---
        const COUNTING_PUZZLES = [
            { objects: 'üçé', count: 3 },
            { objects: '‚≠ê', count: 5 },
            { objects: 'üéà', count: 8 },
            { objects: 'ü¶Ü', count: 4 },
            { objects: 'üöÄ', count: 6 },
        ];

        // --- M√ìDULO: ACHE A S√çLABA INICIAL ---
        const INITIAL_SYLLABLE_PUZZLES = [
            { word: 'FOGUETE', correctSyllable: 'FO', options: ['GU', 'FO', 'TE', 'BO'] },
            { word: 'CORUJA', correctSyllable: 'CO', options: ['RU', 'JA', 'CA', 'CO'] },
            { word: 'TELEFONE', correctSyllable: 'TE', options: ['FO', 'NE', 'TE', 'DA'] },
            { word: 'NAVIO', correctSyllable: 'NA', options: ['BO', 'VI', 'NA', 'NO'] },
        ];

        // --- SISTEMA DE √ÅUDIO CORRIGIDO ---
        class SyllableAudio {
            constructor() {
                this.audioContext = null;
                this.isPlaying = false;
                this.currentUtterance = null;
                this.init();
                // Garante que as vozes sejam carregadas no in√≠cio
                window.speechSynthesis.onvoiceschanged = () => {
                    // console.log("Vozes carregadas.");
                };
            }

            init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (error) {
                    console.warn('Web Audio API n√£o suportada:', error);
                }
            }
            
            // Novo m√©todo CORRIGIDO para o Alfabeto: Fala a letra e depois a palavra
            speakLetterAndWord(letter, word) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    // Primeiro, fala a letra
                    this.speakText(letter, () => {
                        // Ap√≥s a letra, espera um pouco e fala a palavra
                        setTimeout(() => {
                            this.speakText(word);
                        }, 500); 
                    }, letter);
                } else {
                    // Fallback fala a letra e depois a palavra (apenas um som simulado)
                    this.fallbackSound(letter + ' ' + word);
                }
            }

            // Fun√ß√µes de fala que usam s√≠ntese de voz nativa
            speakSyllableWithExamples(syllableData) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    const { syllable, words } = syllableData;
                    this.speakText(syllable, () => {
                        this.speakExamples(words);
                    });
                } else {
                    this.fallbackSound(syllableData.syllable);
                }
            }

            speakSyllable(syllable) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    this.speakText(syllable);
                } else {
                    this.fallbackSound(syllable);
                }
            }

            speakWordExample(word) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    this.speakText(word);
                } else {
                    this.fallbackSound(word);
                }
            }

            speakText(text, onEnd = null) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR';
                utterance.rate = 0.7;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                const voices = speechSynthesis.getVoices();
                const portugueseVoice = voices.find(voice => 
                    voice.lang.includes('pt') || voice.lang.includes('PT')
                );
                if (portugueseVoice) {
                    utterance.voice = portugueseVoice;
                }
                
                utterance.onstart = () => {
                    this.isPlaying = true;
                    this.highlightPlayingText(text, true);
                };
                
                utterance.onend = () => {
                    this.isPlaying = false;
                    this.highlightPlayingText(text, false);
                    if (onEnd) onEnd();
                };
                
                utterance.onerror = (error) => {
                    console.warn('Erro na s√≠ntese de voz:', error);
                    this.isPlaying = false;
                    this.highlightPlayingText(text, false);
                    if (onEnd) onEnd();
                };
                
                this.currentUtterance = utterance;
                speechSynthesis.speak(utterance);
            }

            speakExamples(words) {
                let index = 0;
                const speakNext = () => {
                    if (index < words.length) {
                        setTimeout(() => {
                            this.speakText(words[index], speakNext);
                            index++;
                        }, 800);
                    }
                };
                speakNext();
            }

            // Fallback para dispositivos sem s√≠ntese de voz
            fallbackSound(text) {
                if (!this.audioContext) return;
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    const charSum = text.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);
                    const baseFreq = 300 + (charSum % 300);
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(baseFreq, this.audioContext.currentTime);
                    
                    gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    this.highlightPlayingText(text, true);
                    
                    oscillator.start();
                    oscillator.stop(this.audioContext.currentTime + 0.5);
                    oscillator.onended = () => {
                        this.highlightPlayingText(text, false);
                    };
                    
                } catch (error) {
                    console.warn('Erro ao gerar som:', error);
                }
            }

            highlightPlayingText(text, isPlaying) {
                const previousPlaying = document.querySelectorAll('.playing');
                previousPlaying.forEach(el => el.classList.remove('playing'));
                
                const elements = document.querySelectorAll(`[data-text="${text}"]`);
                elements.forEach(element => {
                    if (isPlaying) {
                        element.classList.add('playing');
                        element.style.color = '#4f46e5';
                    } else {
                        element.classList.remove('playing');
                        element.style.color = '';
                    }
                });
            }

            stop() {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                }
                this.isPlaying = false;
                const playingElements = document.querySelectorAll('.playing');
                playingElements.forEach(el => el.classList.remove('playing'));
            }
        }

        const syllableAudio = new SyllableAudio();
        function playSyllableWithExamples(syllableData) { syllableAudio.speakSyllableWithExamples(syllableData); }
        function playSyllableSound(syllable) { syllableAudio.speakSyllable(syllable); }
        function playWordExample(word) { syllableAudio.speakWordExample(word); }
        // FUN√á√ÉO GLOBAL CORRIGIDA PARA O ALFABETO
        function playLetterAndWord(letter, word) { syllableAudio.speakLetterAndWord(letter, word); }


        // --- ESTADO GLOBAL ---
        const app = document.getElementById('app');
        let playerName = localStorage.getItem('playerName') || '';
        let playerScore = parseInt(localStorage.getItem('playerScore')) || 0;
        let currentAlphabetIndex = 0;
        let currentWordPuzzleIndex = 0; // Para Forma√ß√£o de Palavras (S√≠labas Click)
        let currentCountingPuzzleIndex = 0;
        let currentInitialSyllableIndex = 0;
        let currentSyllablePage = 0;
        let currentWordPuzzleGameIndex = 0; // Para Quebra-Cabe√ßa (Drag & Drop)
        let nextLetterId = 0; // Contador global para IDs √∫nicos de letras drag & drop
        
        let memoryGameState = {
            cards: [],
            flippedCards: [],
            lockBoard: false,
            matchesFound: 0
        };

        const SYLLABLES_PER_PAGE = 5;

        // --- SISTEMA DE RANKING E UTILIT√ÅRIOS ---
        function getRanking() {
            const ranking = localStorage.getItem('gameRanking');
            return ranking ? JSON.parse(ranking) : [];
        }

        function saveToRanking(name, score) {
            const ranking = getRanking();
            const existingPlayerIndex = ranking.findIndex(player => player.name === name);
            if (existingPlayerIndex !== -1) {
                if (score > ranking[existingPlayerIndex].score) {
                    ranking[existingPlayerIndex].score = score;
                    ranking[existingPlayerIndex].date = new Date().toLocaleDateString('pt-BR');
                }
            } else {
                ranking.push({ name: name, score: score, date: new Date().toLocaleDateString('pt-BR') });
            }
            ranking.sort((a, b) => b.score - a.score);
            const topRanking = ranking.slice(0, 10);
            localStorage.setItem('gameRanking', JSON.stringify(topRanking));
        }

        function updateScore(points) {
            playerScore += points;
            localStorage.setItem('playerScore', playerScore);
            const scoreDisplay = document.getElementById('score-display');
            if (scoreDisplay) {
                scoreDisplay.textContent = `‚≠ê Pontos: ${playerScore}`;
            }
        }

        function updatePlayerName(name) {
            if (playerName && playerScore > 0) {
                saveToRanking(playerName, playerScore);
            }
            playerName = name.toUpperCase();
            playerScore = 0;
            localStorage.setItem('playerName', playerName);
            localStorage.setItem('playerScore', playerScore);
            goToScreen('home');
        }

        function resetPlayerData() {
            if (playerName && playerScore > 0) {
                saveToRanking(playerName, playerScore);
            }
            playerName = '';
            playerScore = 0;
            localStorage.removeItem('playerName');
            localStorage.removeItem('playerScore');
            goToScreen('welcome');
        }
        
        // Fun√ß√£o utilit√°ria para embaralhar arrays
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function playSound(type) {
            // Placeholder para futuras implementa√ß√µes de √°udio ou som
            console.log(`[SOUND: ${type}]`);
        }
        
        function showFeedback(message, color = 'green', duration = 2000) {
            let feedback = document.getElementById('feedback-alert');
            if (!feedback) {
                feedback = document.createElement('div');
                feedback.id = 'feedback-alert';
                feedback.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 p-4 rounded-xl font-bold text-white shadow-xl z-50 transition-all duration-300 opacity-0 scale-90';
                document.body.appendChild(feedback);
            }
            
            let bgColor = `bg-${color}-500`;
            if (color === 'red') bgColor = 'bg-red-600';
            if (color === 'blue') bgColor = 'bg-blue-600';
            if (color === 'yellow') bgColor = 'bg-yellow-600';
            if (color === 'green') bgColor = 'bg-green-600';
            if (color === 'teal') bgColor = 'bg-teal-600';

            feedback.className = `fixed top-4 left-1/2 transform -translate-x-1/2 p-4 rounded-xl font-bold text-white shadow-xl z-50 transition-all duration-300 opacity-0 scale-90 ${bgColor}`;
            feedback.innerHTML = message;
            
            setTimeout(() => {
                feedback.classList.remove('opacity-0', 'scale-90');
                feedback.classList.add('opacity-100', 'scale-100');
            }, 50);

            setTimeout(() => {
                feedback.classList.remove('opacity-100', 'scale-100');
                feedback.classList.add('opacity-0', 'scale-90');
            }, duration);
        }

        // Fun√ß√£o para ir para uma tela espec√≠fica
        function goToScreen(screenName) {
            syllableAudio.stop();
            app.innerHTML = '';
            
            if (screenName === 'welcome') {
                renderWelcome();
            } else if (screenName === 'home') {
                renderHome();
            } else if (screenName === 'alphabet') {
                currentAlphabetIndex = 0;
                renderAlphabetGame();
            } else if (screenName === 'words') {
                currentWordPuzzleIndex = 0;
                shuffleArray(WORD_PUZZLES);
                renderWordFormationGame();
            } else if (screenName === 'counting') {
                currentCountingPuzzleIndex = 0;
                shuffleArray(COUNTING_PUZZLES);
                renderCountingGame();
            } else if (screenName === 'initialSyllable') {
                currentInitialSyllableIndex = 0;
                shuffleArray(INITIAL_SYLLABLE_PUZZLES);
                renderInitialSyllableGame();
            } else if (screenName === 'allSyllables') {
                currentSyllablePage = 0;
                renderAllSyllables();
            } else if (screenName === 'wordPuzzle') {
                currentWordPuzzleGameIndex = 0;
                shuffleArray(WORD_PUZZLES_DATA);
                renderWordPuzzleGame();
            } else if (screenName === 'memoryGame') {
                renderMemoryGame();
            } else if (screenName === 'ranking') {
                renderRanking();
            } else if (screenName === 'changeName') {
                renderChangeName();
            }
        }

        // --- 0. TELA DE BOAS-VINDAS E NOME ---
        function renderWelcome() {
            app.innerHTML = `
                <div class="text-center">
                    <h1 class="text-5xl font-extrabold text-blue-700 mb-4">üåà Arca do Conhecimento</h1>
                    <p class="text-xl text-gray-600 mb-8">Aprenda a ler brincando!</p>
                    <div class="max-w-sm mx-auto p-6 bg-white rounded-xl shadow-lg border-2 border-blue-200">
                        <h2 class="text-2xl font-bold text-blue-500 mb-4">Qual √© o seu nome?</h2>
                        <input
                            type="text"
                            id="name-input"
                            placeholder="Digite seu nome aqui"
                            maxlength="15"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg text-center mb-6 focus:border-blue-500 transition-all duration-200"
                        />
                        <button
                            onclick="handleNameInput()"
                            class="w-full py-3 px-6 bg-blue-500 text-white font-bold text-xl rounded-xl shadow-md hover:bg-blue-600 transition-all duration-200"
                        >
                            Come√ßar!
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('name-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleNameInput();
                }
            });
        }

        function handleNameInput() {
            const input = document.getElementById('name-input');
            const name = input.value.trim();
            if (name.length > 1) {
                updatePlayerName(name);
            } else {
                showFeedback('Por favor, digite um nome v√°lido.', 'red', 2000);
                input.classList.add('shake');
                setTimeout(() => input.classList.remove('shake'), 500);
            }
        }

        // --- 1. TELA INICIAL (HOME) ---
        function renderHome() {
            app.innerHTML = `
                <h1 class="text-4xl sm:text-5xl font-extrabold text-blue-700 mb-2 text-center">
                    Ol√°, ${playerName}! üëã
                </h1>
                <div class="flex justify-center mb-6">
                    <span id="score-display" class="text-2xl font-black text-yellow-600 border-b-4 border-yellow-400 pb-1">
                        ‚≠ê Pontos: ${playerScore}
                    </span>
                </div>
                <p class="text-xl text-gray-600 mb-10 text-center font-medium">
                    Escolha um desafio para ganhar pontos!
                </p>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                    ${createGameButton('O Alfabeto', 'Descubra letras e palavras', 'bg-red-500', 'alphabet')}
                    ${createGameButton('Todas as S√≠labas', 'Explore s√≠labas e exemplos', 'bg-indigo-500', 'allSyllables')}
                    ${createGameButton('Forme Palavras', 'Monte letras e s√≠labas', 'bg-green-500', 'words')}
                    ${createGameButton('Contagem', 'Aprenda a contar objetos', 'bg-yellow-500', 'counting')}
                    ${createGameButton('Ache a S√≠laba', 'Identifique a s√≠laba inicial', 'bg-purple-500', 'initialSyllable')}
                    ${createGameButton('Quebra-Cabe√ßa', 'Arraste letras para formar palavras', 'bg-pink-500', 'wordPuzzle')}
                    ${createGameButton('Jogo da Mem√≥ria', 'Ache pares de palavras e s√≠labas', 'bg-teal-500', 'memoryGame')}
                    ${createGameButton('Mudar Nome', `Zerar score e trocar nome`, 'bg-gray-400', 'changeName')}
                    ${createGameButton('Ranking', 'Top 10 melhores jogadores', 'bg-yellow-400', 'ranking')}
                </div>
                <div class="mt-8 text-center text-sm text-gray-400">
                    O conhecimento √© a chave da arca!
                </div>
            `;
        }

        function createGameButton(title, description, color, target) {
            return `
                <button
                    onclick="goToScreen('${target}')"
                    class="p-6 h-full flex flex-col items-center justify-center text-white rounded-xl shadow-lg transform transition duration-200 hover:scale-[1.03] ${color}"
                >
                    <span class="text-3xl font-black mb-2">${title}</span>
                    <span class="text-sm font-light text-center">${description}</span>
                </button>
            `;
        }

        // --- 2. JOGO DO ALFABETO (Letra + Palavra) ---
        function renderAlphabetGame() {
            if (currentAlphabetIndex >= ALPHABET_DATA.length) {
                showFeedback(`üéâ Fim do Alfabeto! Voltando ao menu.`, 'blue', 2000);
                goToScreen('home');
                return;
            }

            const data = ALPHABET_DATA[currentAlphabetIndex];
            const initialSyllable = data.syllables[0];
            const highlightedWord = data.word.replace(initialSyllable, `<span class="highlight-syllable">${initialSyllable}</span>`);

            app.innerHTML = `
                <h2 class="text-3xl font-bold text-red-600 mb-6 text-center">üÖ∞Ô∏è O Alfabeto (Letra e Palavra)</h2>
                
                <div class="flex justify-center mb-6">
                    <span id="score-display" class="text-2xl font-black text-yellow-600 border-b-4 border-yellow-400 pb-1">
                        ‚≠ê Pontos: ${playerScore}
                    </span>
                </div>

                <div class="bg-red-50 p-8 rounded-2xl border-4 border-red-300 shadow-inner flex flex-col items-center">
                    <div
                        class="letter-card bg-white p-10 rounded-xl shadow-lg border-b-8 border-red-500 mb-6 text-center w-full max-w-sm cursor-pointer"
                        onclick="playLetterAndWord('${data.letter}', '${data.word}')"
                        data-text="${data.letter}"
                    >
                        <span class="text-9xl font-black text-red-700 block mb-2">${data.letter}</span>
                        <p class="text-4xl font-extrabold text-gray-800">${data.emoji} ${highlightedWord}</p>
                        <p class="text-sm text-gray-500 mt-2">Clique para ouvir a letra e a palavra</p>
                    </div>

                    <div class="flex space-x-4">
                        <button
                            onclick="nextAlphabetLetter()"
                            class="py-3 px-6 bg-red-500 text-white font-bold text-xl rounded-xl shadow-md hover:bg-red-600 transition-all duration-200"
                        >
                            Pr√≥xima Letra (L +10)
                        </button>
                        <button
                            onclick="goToScreen('home')"
                            class="py-3 px-6 bg-gray-400 text-white font-bold text-xl rounded-xl shadow-md hover:bg-gray-500 transition-all duration-200"
                        >
                            Voltar
                        </button>
                    </div>
                </div>
                
                <div class="mt-4 text-center text-sm text-gray-500">
                    Letra ${currentAlphabetIndex + 1} de ${ALPHABET_DATA.length}
                </div>
            `;

            // Garante que o som inicial seja reproduzido automaticamente, se for a primeira letra
            if (currentAlphabetIndex === 0) {
                 playLetterAndWord(data.letter, data.word);
            }
        }

        function nextAlphabetLetter() {
            updateScore(10);
            currentAlphabetIndex++;
            renderAlphabetGame();
        }

        // --- 3. M√ìDULO: TODAS AS S√çLABAS (Exemplos) ---
        function renderAllSyllables() {
            const start = currentSyllablePage * SYLLABLES_PER_PAGE;
            const end = start + SYLLABLES_PER_PAGE;
            const currentPageSyllables = ALL_SYLLABLES_DATA.slice(start, end);
            const totalPages = Math.ceil(ALL_SYLLABLES_DATA.length / SYLLABLES_PER_PAGE);

            app.innerHTML = `
                <h2 class="text-3xl font-bold text-indigo-600 mb-6 text-center">üìö Explorando as S√≠labas</h2>
                <div class="flex justify-between items-center mb-6">
                    <span id="score-display" class="text-xl font-black text-yellow-600"> ‚≠ê Pontos: ${playerScore} </span>
                    <button
                        onclick="goToScreen('home')"
                        class="py-2 px-4 bg-gray-400 text-white font-bold rounded-xl hover:bg-gray-500 transition-all duration-200"
                    >
                        Voltar
                    </button>
                </div>

                <div class="bg-indigo-50 p-6 rounded-2xl border-4 border-indigo-300 shadow-inner">
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        ${currentPageSyllables.map(data => {
                            // CORRE√á√ÉO: Pula e insere um espa√ßo vazio para os placeholders
                            if (data.placeholder) {
                                return `<div class="p-4 rounded-xl"></div>`; // Div vazia para ocupar o espa√ßo do grid
                            }

                            const wordsHtml = data.words.map(word => `
                                <span 
                                    class="word-example text-sm text-gray-600 inline-block px-2 py-1 bg-indigo-100 rounded-full mr-1 mt-1 border border-indigo-200" 
                                    data-text="${word}"
                                    onclick="event.stopPropagation(); playWordExample('${word}')"
                                >
                                    ${word}
                                </span>
                            `).join('');
                            
                            const wordsString = data.words.join("','"); // Para a fun√ß√£o de √°udio
                            
                            return `
                                <div
                                    class="syllable-card bg-white p-4 rounded-xl shadow-lg border-b-4 border-indigo-500 text-center cursor-pointer flex flex-col justify-between"
                                    onclick="playSyllableWithExamples({syllable: '${data.syllable}', words: ['${wordsString}']})"
                                >
                                    <div class="flex justify-between items-start">
                                        <span class="text-5xl font-black text-indigo-700 block">${data.syllable.toUpperCase()}</span>
                                        <span class="text-3xl text-gray-500">${data.emoji}</span>
                                    </div>
                                    <div class="mt-3 text-left">
                                        <p class="text-lg font-semibold text-gray-700">Exemplos:</p>
                                        ${wordsHtml}
                                    </div>
                                    <div class="text-right mt-2">
                                        <span class="speaker-icon text-indigo-500 text-2xl">üîä</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="flex justify-between items-center mt-6">
                        <button
                            onclick="prevSyllablePage()"
                            class="py-2 px-4 bg-indigo-500 text-white font-bold rounded-xl hover:bg-indigo-600 transition-all duration-200 disabled:opacity-50"
                            ${currentSyllablePage === 0 ? 'disabled' : ''}
                        >
                            &larr; Anterior
                        </button>
                        <span class="text-sm font-semibold text-indigo-700">P√°gina ${currentSyllablePage + 1} de ${totalPages}</span>
                        <button
                            onclick="nextSyllablePage()"
                            class="py-2 px-4 bg-indigo-500 text-white font-bold rounded-xl hover:bg-indigo-600 transition-all duration-200 disabled:opacity-50"
                            ${currentSyllablePage >= totalPages - 1 ? 'disabled' : ''}
                        >
                            Pr√≥xima &rarr;
                        </button>
                    </div>
                </div>
            `;
        }

        function nextSyllablePage() {
            currentSyllablePage++;
            renderAllSyllables();
        }

        function prevSyllablePage() {
            currentSyllablePage--;
            renderAllSyllables();
        }

        // --- 4. M√ìDULO: FORMA√á√ÉO DE PALAVRAS (S√≠labas Click) ---
        let currentWordSegments = [];

        function renderWordFormationGame() {
            if (currentWordPuzzleIndex >= WORD_PUZZLES.length) {
                showFeedback('üéâ Voc√™ formou todas as palavras! +100 pontos!', 'green', 3000);
                updateScore(100);
                goToScreen('home');
                return;
            }

            const puzzle = WORD_PUZZLES[currentWordPuzzleIndex];
            const segments = shuffleArray([...puzzle.segments]);

            app.innerHTML = `
                <h2 class="text-3xl font-bold text-green-600 mb-6 text-center">üß© Forme a Palavra (S√≠labas)</h2>
                <div class="flex justify-center mb-6">
                    <span id="score-display" class="text-2xl font-black text-yellow-600 border-b-4 border-yellow-400 pb-1"> ‚≠ê Pontos: ${playerScore} </span>
                </div>
                
                <div class="bg-green-50 p-8 rounded-2xl border-4 border-green-300 shadow-inner flex flex-col items-center">
                    
                    <div class="mb-8 p-4 bg-white rounded-xl shadow-inner border-2 border-gray-200 w-full max-w-lg">
                        <p class="text-xl text-gray-600 mb-2 font-semibold text-center">Palavra a ser formada:</p>
                        <div id="word-slots" class="flex justify-center space-x-3 bg-green-100 p-4 rounded-lg border-2 border-green-400 min-h-[70px]">
                            ${puzzle.segments.map((segment, index) => `
                                <div 
                                    id="slot-syllable-${index}"
                                    class="syllable-slot w-24 h-16 bg-white border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-3xl font-bold text-gray-500"
                                >
                                    ?
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <p class="text-xl text-gray-700 mb-4 font-semibold">Escolha a pr√≥xima s√≠laba:</p>
                    <div id="syllable-options" class="flex flex-wrap justify-center gap-4 mb-8">
                        ${segments.map(segment => `
                            <button
                                onclick="addSyllableToWord('${segment}')"
                                class="syllable-option py-3 px-6 bg-green-500 text-white font-black text-2xl rounded-xl shadow-md transform transition duration-200 hover:scale-[1.05] hover:bg-green-600"
                                data-syllable="${segment}"
                            >
                                ${segment}
                            </button>
                        `).join('')}
                    </div>

                    <div class="flex space-x-4">
                        <button
                            onclick="checkWordFormation()"
                            class="py-3 px-6 bg-blue-500 text-white font-bold rounded-xl hover:bg-blue-600 transition-all duration-200 shadow-md"
                        >
                            Verificar
                        </button>
                        <button
                            onclick="resetWordFormation()"
                            class="py-3 px-6 bg-yellow-500 text-white font-bold rounded-xl hover:bg-yellow-600 transition-all duration-200 shadow-md"
                        >
                            Limpar
                        </button>
                        <button
                            onclick="goToScreen('home')"
                            class="py-3 px-6 bg-gray-400 text-white font-bold rounded-xl hover:bg-gray-500 transition-all duration-200"
                        >
                            Voltar
                        </button>
                    </div>
                </div>

                <div class="mt-4 text-center text-sm text-gray-500">
                    Palavra ${currentWordPuzzleIndex + 1} de ${WORD_PUZZLES.length}
                </div>
            `;
            currentWordSegments = [];
            
            // Pr√©-seleciona o primeiro slot para feedback visual
            const firstSlot = document.getElementById('slot-syllable-0');
            if (firstSlot) {
                firstSlot.style.borderColor = '#34d399'; // green-400
                firstSlot.style.backgroundColor = '#dcfce7'; // green-50
            }
        }

        function addSyllableToWord(syllable) {
            const index = currentWordSegments.length;
            const puzzle = WORD_PUZZLES[currentWordPuzzleIndex];

            if (index >= puzzle.segments.length) {
                showFeedback('Palavra completa! Clique em Verificar.', 'yellow', 1500);
                return;
            }

            currentWordSegments.push(syllable);
            const slot = document.getElementById(`slot-syllable-${index}`);
            const button = document.querySelector(`.syllable-option[data-syllable="${syllable}"]`);
            
            if (slot) {
                slot.textContent = syllable;
                slot.classList.remove('bg-white', 'border-dashed', 'border-gray-300');
                slot.classList.add('bg-green-300', 'text-green-800', 'border-green-500');
            }
            if (button) {
                button.disabled = true;
                button.classList.add('opacity-50', 'cursor-not-allowed');
                button.classList.remove('hover:scale-[1.05]', 'hover:bg-green-600');
            }
            
            // Remove highlight do slot atual e move para o pr√≥ximo (se existir)
            if (slot) {
                slot.style.borderColor = '#10b981'; // green-500
                slot.style.backgroundColor = '#ecfdf5'; // green-50
            }

            const nextIndex = index + 1;
            const nextSlot = document.getElementById(`slot-syllable-${nextIndex}`);
            if (nextSlot) {
                nextSlot.style.borderColor = '#34d399'; // green-400
                nextSlot.style.backgroundColor = '#dcfce7'; // green-50
            } else {
                showFeedback('Pronto para verificar!', 'blue', 1500);
            }
        }

        function resetWordFormation() {
            currentWordSegments = [];
            renderWordFormationGame(); // Recarrega a tela para resetar
        }

        function checkWordFormation() {
            const puzzle = WORD_PUZZLES[currentWordPuzzleIndex];
            const correctWord = puzzle.word;
            const builtWord = currentWordSegments.join('');

            if (builtWord === correctWord) {
                showFeedback(`‚úÖ Parab√©ns! Voc√™ formou a palavra ${correctWord}! +50 pontos.`, 'green', 2000);
                playSound('success');
                updateScore(50);
                
                // Marca slots como corretos
                puzzle.segments.forEach((_, index) => {
                    const slot = document.getElementById(`slot-syllable-${index}`);
                    if (slot) {
                        slot.classList.add('correct');
                        slot.style.borderColor = '#16a34a'; // green-600
                    }
                });

                // Toca a palavra
                playWordExample(correctWord);

                setTimeout(() => {
                    currentWordPuzzleIndex++;
                    renderWordFormationGame();
                }, 1500);

            } else {
                showFeedback(`‚ùå Palavra incorreta! Tente novamente. -10 pontos.`, 'red', 2000);
                playSound('error');
                updateScore(-10);

                const slots = document.getElementById('word-slots');
                slots.classList.add('shake');
                setTimeout(() => slots.classList.remove('shake'), 500);

                // Limpa e habilita bot√µes novamente
                resetWordFormation();
            }
        }

        // --- 5. M√ìDULO: CONTAGEM ---
        function renderCountingGame() {
            if (currentCountingPuzzleIndex >= COUNTING_PUZZLES.length) {
                showFeedback('üéâ Voc√™ completou todos os desafios de Contagem! +100 pontos!', 'blue', 3000);
                updateScore(100);
                goToScreen('home');
                return;
            }

            const puzzle = COUNTING_PUZZLES[currentCountingPuzzleIndex];
            const objectsString = puzzle.objects.repeat(puzzle.count);
            
            // Gera op√ß√µes (n√∫mero correto e 3 incorretos)
            let options = [puzzle.count];
            while (options.length < 4) {
                const randomNum = Math.floor(Math.random() * 8) + 1; // 1 a 8
                if (!options.includes(randomNum)) {
                    options.push(randomNum);
                }
            }
            options = shuffleArray(options);

            app.innerHTML = `
                <h2 class="text-3xl font-bold text-yellow-600 mb-6 text-center">üî¢ Jogo da Contagem</h2>
                <div class="flex justify-center mb-6">
                    <span id="score-display" class="text-2xl font-black text-yellow-600 border-b-4 border-yellow-400 pb-1"> ‚≠ê Pontos: ${playerScore} </span>
                </div>
                
                <div class="bg-yellow-50 p-8 rounded-2xl border-4 border-yellow-300 shadow-inner flex flex-col items-center">
                    
                    <p class="text-2xl font-semibold text-gray-700 mb-4 text-center">Quantos objetos voc√™ v√™?</p>
                    
                    <div class="mb-8 p-6 bg-white rounded-xl shadow-lg border-4 border-yellow-400 w-full max-w-lg text-center">
                        <div class="text-5xl sm:text-7xl break-all">${objectsString}</div>
                    </div>

                    <div id="counting-options" class="flex flex-wrap justify-center gap-4 mb-8">
                        ${options.map(option => `
                            <button
                                onclick="checkCountingAnswer(${option}, ${puzzle.count})"
                                class="py-4 px-8 bg-yellow-500 text-white font-black text-3xl rounded-xl shadow-md transform transition duration-200 hover:scale-[1.05] hover:bg-yellow-600 counting-option"
                            >
                                ${option}
                            </button>
                        `).join('')}
                    </div>

                    <button
                        onclick="goToScreen('home')"
                        class="py-3 px-6 bg-gray-400 text-white font-bold rounded-xl hover:bg-gray-500 transition-all duration-200"
                    >
                        Voltar
                    </button>
                </div>

                <div class="mt-4 text-center text-sm text-gray-500">
                    Puzzle ${currentCountingPuzzleIndex + 1} de ${COUNTING_PUZZLES.length}
                </div>
            `;
        }

        function checkCountingAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.counting-option');
            buttons.forEach(button => button.disabled = true); // Desabilita bot√µes para evitar cliques m√∫ltiplos

            if (selected === correct) {
                showFeedback(`‚úÖ Correto! Havia ${correct} objetos. +30 pontos!`, 'green', 2000);
                playSound('success');
                updateScore(30);

                // Destaca o bot√£o correto
                document.querySelector(`.counting-option:nth-child(${buttons.length - 1 - buttons.length + buttons.length})`).classList.add('bg-green-500'); // Simplificado
                
                setTimeout(() => {
                    currentCountingPuzzleIndex++;
                    renderCountingGame();
                }, 1500);

            } else {
                showFeedback(`‚ùå Incorreto! O n√∫mero correto era ${correct}. -15 pontos.`, 'red', 2000);
                playSound('error');
                updateScore(-15);

                // Destaca o correto e o incorreto
                buttons.forEach(button => {
                    if (parseInt(button.textContent.trim()) === correct) {
                        button.classList.remove('bg-yellow-500');
                        button.classList.add('bg-green-500');
                    } else if (parseInt(button.textContent.trim()) === selected) {
                        button.classList.remove('bg-yellow-500');
                        button.classList.add('bg-red-500');
                        button.classList.add('shake');
                        setTimeout(() => button.classList.remove('shake'), 500);
                    }
                });

                setTimeout(() => {
                    currentCountingPuzzleIndex++;
                    renderCountingGame();
                }, 1500);
            }
        }

        // --- 6. M√ìDULO: ACHE A S√çLABA INICIAL ---
        function renderInitialSyllableGame() {
            if (currentInitialSyllableIndex >= INITIAL_SYLLABLE_PUZZLES.length) {
                showFeedback('üéâ Voc√™ completou todos os desafios de S√≠laba Inicial! +100 pontos!', 'blue', 3000);
                updateScore(100);
                goToScreen('home');
                return;
            }

            const puzzle = INITIAL_SYLLABLE_PUZZLES[currentInitialSyllableIndex];
            const highlightedWord = puzzle.word.replace(puzzle.correctSyllable, `<span class="highlight-syllable">${puzzle.correctSyllable}</span>`);
            const options = shuffleArray([...puzzle.options]);

            app.innerHTML = `
                <h2 class="text-3xl font-bold text-purple-600 mb-6 text-center">üîç Ache a S√≠laba Inicial</h2>
                <div class="flex justify-center mb-6">
                    <span id="score-display" class="text-2xl font-black text-yellow-600 border-b-4 border-yellow-400 pb-1"> ‚≠ê Pontos: ${playerScore} </span>
                </div>
                
                <div class="bg-purple-50 p-8 rounded-2xl border-4 border-purple-300 shadow-inner flex flex-col items-center">
                    
                    <div class="mb-8 p-6 bg-white rounded-xl shadow-lg border-4 border-purple-400 w-full max-w-lg text-center">
                        <p class="text-2xl font-semibold text-gray-700 mb-2">Qual √© a s√≠laba inicial?</p>
                        <p 
                            class="text-5xl font-extrabold text-gray-800 cursor-pointer" 
                            onclick="playWordExample('${puzzle.word}')"
                            data-text="${puzzle.word}"
                        >
                            ${puzzle.word}
                        </p>
                        <p class="text-sm text-gray-500 mt-1">Clique para ouvir a palavra</p>
                    </div>

                    <div id="syllable-initial-options" class="grid grid-cols-2 gap-4 mb-8 w-full max-w-sm">
                        ${options.map(option => `
                            <button
                                onclick="checkInitialSyllableAnswer('${option}', '${puzzle.correctSyllable}')"
                                class="py-4 px-6 bg-purple-500 text-white font-black text-2xl rounded-xl shadow-md transform transition duration-200 hover:scale-[1.05] hover:bg-purple-600 initial-syllable-option"
                                data-text="${option}"
                            >
                                ${option}
                            </button>
                        `).join('')}
                    </div>

                    <button
                        onclick="goToScreen('home')"
                        class="py-3 px-6 bg-gray-400 text-white font-bold rounded-xl hover:bg-gray-500 transition-all duration-200"
                    >
                        Voltar
                    </button>
                </div>

                <div class="mt-4 text-center text-sm text-gray-500">
                    Puzzle ${currentInitialSyllableIndex + 1} de ${INITIAL_SYLLABLE_PUZZLES.length}
                </div>
            `;
            playWordExample(puzzle.word); // Toca a palavra automaticamente
        }

        function checkInitialSyllableAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.initial-syllable-option');
            buttons.forEach(button => button.disabled = true); // Desabilita bot√µes

            if (selected === correct) {
                showFeedback(`‚úÖ Correto! A s√≠laba inicial √© "${correct}". +40 pontos!`, 'green', 2000);
                playSound('success');
                updateScore(40);

                // Destaca o bot√£o correto
                buttons.forEach(button => {
                    if (button.textContent.trim() === correct) {
                        button.classList.remove('bg-purple-500');
                        button.classList.add('bg-green-500');
                    }
                });
                
                setTimeout(() => {
                    currentInitialSyllableIndex++;
                    renderInitialSyllableGame();
                }, 1500);

            } else {
                showFeedback(`‚ùå Incorreto! A s√≠laba inicial n√£o √© "${selected}". -20 pontos.`, 'red', 2000);
                playSound('error');
                updateScore(-20);

                // Destaca o correto e o incorreto
                buttons.forEach(button => {
                    if (button.textContent.trim() === correct) {
                        button.classList.remove('bg-purple-500');
                        button.classList.add('bg-green-500');
                    } else if (button.textContent.trim() === selected) {
                        button.classList.remove('bg-purple-500');
                        button.classList.add('bg-red-500');
                        button.classList.add('shake');
                        setTimeout(() => button.classList.remove('shake'), 500);
                    }
                });
                
                setTimeout(() => {
                    currentInitialSyllableIndex++;
                    renderInitialSyllableGame();
                }, 1500);
            }
        }

        // --- 7. M√ìDULO: QUEBRA-CABE√áA DE PALAVRAS (Letras Drag & Drop) ---
        function renderWordPuzzleGame() {
            if (currentWordPuzzleGameIndex >= WORD_PUZZLES_DATA.length) {
                showFeedback('üéâ Voc√™ completou todos os Quebra-Cabe√ßas! +100 pontos!', 'blue', 3000);
                updateScore(100);
                goToScreen('home');
                return;
            }

            const puzzle = WORD_PUZZLES_DATA[currentWordPuzzleGameIndex];
            const letters = shuffleArray(puzzle.word.split(''));

            app.innerHTML = `
                <h2 class="text-3xl font-bold text-pink-600 mb-6 text-center">üß© Quebra-Cabe√ßa de Palavras</h2>
                <div class="flex justify-center mb-6">
                    <span id="score-display" class="text-2xl font-black text-yellow-600 border-b-4 border-yellow-400 pb-1"> ‚≠ê Pontos: ${playerScore} </span>
                </div>
                
                <div class="bg-pink-50 p-8 rounded-2xl border-4 border-pink-300 shadow-inner flex flex-col items-center w-full max-w-lg mx-auto">
                    
                    <p class="text-2xl font-semibold text-gray-700 mb-4 text-center">Arraste as letras para formar a palavra:</p>
                    
                    <div id="puzzle-slots" class="flex justify-center space-x-3 mb-8 w-full">
                        ${puzzle.word.split('').map((_, index) => `
                            <div 
                                id="slot-${index}"
                                ondrop="dropLetter(event)"
                                ondragover="allowDrop(event)"
                                ondragleave="event.currentTarget.classList.remove('highlight')"
                                class="puzzle-slot flex-1 border-2 border-dashed border-gray-400 rounded-lg flex items-center justify-center bg-white"
                                data-index="${index}"
                            >
                            </div>
                        `).join('')}
                    </div>

                    <div id="puzzle-letters" class="flex flex-wrap justify-center gap-3 p-4 bg-white rounded-lg shadow-md border-2 border-pink-200 mb-8 w-full">
                        ${letters.map((letter, index) => `
                            <div
                                id="letter-${nextLetterId++}"
                                class="puzzle-letter py-3 px-4 bg-pink-500 text-white font-black text-2xl rounded-xl shadow-md"
                                draggable="true"
                                ondragstart="dragLetter(event)"
                                data-letter="${letter}"
                            >
                                ${letter}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="flex space-x-4">
                        <button
                            onclick="showPuzzleHint(WORD_PUZZLES_DATA[currentWordPuzzleGameIndex])"
                            class="puzzle-hint py-3 px-6 bg-yellow-500 text-white font-bold rounded-xl hover:bg-yellow-600 transition-all duration-200 shadow-md"
                        >
                            Dica (${puzzle.emoji})
                        </button>
                        <button
                            onclick="checkPuzzleSolution('${puzzle.word}')"
                            class="py-3 px-6 bg-pink-500 text-white font-bold rounded-xl hover:bg-pink-600 transition-all duration-200 shadow-md"
                        >
                            Verificar
                        </button>
                    </div>
                </div>
                
                <div class="mt-4 text-center text-sm text-gray-500">
                    Puzzle ${currentWordPuzzleGameIndex + 1} de ${WORD_PUZZLES_DATA.length}
                </div>
            `;
            
            // Inicializa o estado do puzzle
            window.puzzleState = {
                targetWord: puzzle.word,
                placedLetters: Array(puzzle.word.length).fill(null),
                remainingLetters: [...letters]
            };
        }

        // Fun√ß√µes de Drag & Drop
        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('highlight');
        }

        function dragLetter(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
            ev.dataTransfer.setData("letter", ev.target.getAttribute('data-letter'));
        }

        function dropLetter(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('highlight');
            
            const letterId = ev.dataTransfer.getData("text");
            const letter = ev.dataTransfer.getData("letter");
            const targetSlot = ev.currentTarget;
            const targetIndex = parseInt(targetSlot.getAttribute('data-index'));

            // N√£o permite soltar se o slot j√° tem uma letra
            if (targetSlot.children.length > 0) {
                // Se a letra que est√° sendo arrastada j√° estava colocada, apenas move
                if (document.getElementById(letterId).classList.contains('placed')) {
                    
                    // Encontra o slot de onde a letra veio
                    const previousSlot = document.getElementById(letterId).parentElement;
                    const previousIndex = parseInt(previousSlot.getAttribute('data-index'));

                    // Remove a letra do slot anterior no estado
                    window.puzzleState.placedLetters[previousIndex] = null;
                    
                    // Move a letra para o novo slot
                    const tempLetterEl = targetSlot.children[0];
                    previousSlot.appendChild(tempLetterEl);
                    window.puzzleState.placedLetters[previousIndex] = tempLetterEl.getAttribute('data-letter');
                    
                } else {
                    showFeedback('Este espa√ßo j√° est√° ocupado!', 'yellow', 1000);
                    return;
                }
            }

            const letterEl = document.getElementById(letterId);
            
            // Se a letra est√° voltando da √°rea de op√ß√µes (n√£o tem 'placed')
            if (!letterEl.classList.contains('placed')) {
                // Remove a letra da lista de restantes (visual n√£o precisa, mas o estado sim)
                const indexInRemaining = window.puzzleState.remainingLetters.indexOf(letter);
                if (indexInRemaining > -1) {
                    window.puzzleState.remainingLetters.splice(indexInRemaining, 1);
                }
            }
            
            targetSlot.appendChild(letterEl);
            letterEl.classList.add('placed');
            letterEl.style.position = 'static';
            letterEl.style.transform = 'none';

            // Atualiza o estado global
            window.puzzleState.placedLetters[targetIndex] = letter;
        }

        function dragEnd(ev) {
            const letterEl = ev.target;
            // Se a letra foi colocada no slot, ela n√£o deve voltar
            if (letterEl.classList.contains('placed')) return;
            
            // Se soltou no lugar errado, a letra volta visualmente (o estado j√° est√° ok)
            letterEl.style.left = '0';
            letterEl.style.top = '0';
        }

        function checkPuzzleSolution(targetWord) {
            const placedLetters = window.puzzleState.placedLetters;
            const currentWord = placedLetters.map(l => l || '_').join('');
            
            if (currentWord.includes('_')) {
                showFeedback('Preencha todas as caixas primeiro!', 'yellow', 2000);
                return;
            }

            if (currentWord === targetWord) {
                showFeedback(`‚úÖ Palavra correta! ${targetWord}! +50 pontos.`, 'green', 2000);
                playSound('success');
                updateScore(50);
                playWordExample(targetWord);
                
                // Marca todas as letras e slots como corretos
                placedLetters.forEach((_, index) => {
                    const slot = document.getElementById(`slot-${index}`);
                    const letterEl = slot.querySelector('.puzzle-letter');
                    if (slot) slot.classList.add('correct');
                    if (letterEl) letterEl.classList.add('correct');
                });
                
                setTimeout(() => {
                    currentWordPuzzleGameIndex++;
                    renderWordPuzzleGame();
                }, 1500);

            } else {
                showFeedback(`‚ùå Palavra incorreta! Reveja as letras nas posi√ß√µes. -5 pontos.`, 'red', 2000);
                playSound('error');
                
                updateScore(-5);
                
                const slots = document.getElementById('puzzle-slots');
                slots.classList.add('shake');
                setTimeout(() => slots.classList.remove('shake'), 500);

                // Feedback visual para letras incorretas
                window.puzzleState.placedLetters.forEach((letter, index) => {
                    const slot = document.getElementById(`slot-${index}`);
                    const correctLetter = targetWord[index];
                    const letterEl = slot.querySelector('.puzzle-letter');

                    if (letter && letter !== correctLetter) {
                        slot.classList.remove('correct');
                        if (letterEl) {
                            letterEl.classList.remove('correct');
                            letterEl.classList.add('bg-red-300', 'border-red-500'); // Destaca incorreta
                            setTimeout(() => {
                                letterEl.classList.remove('bg-red-300', 'border-red-500');
                                letterEl.classList.add('bg-pink-500'); // Volta √† cor padr√£o
                            }, 500);
                        }
                    } else if (letter && letter === correctLetter) {
                        // Mant√©m correta j√° colocada
                        slot.classList.add('correct');
                        if (letterEl) letterEl.classList.add('correct');
                    }
                });
            }
        }

        function showPuzzleHint(puzzle) {
            showFeedback(`Dica: ${puzzle.hint}`, 'yellow', 3000);
        }

      // --- 10. JOGO DA MEM√ìRIA EDUCATIVO (Fun√ß√µes Centrais) ---
        function initializeMemoryGame() {
            // 1. Cria a lista de cartas duplas (Palavra e S√≠laba)
            let cards = [];
            MEMORY_GAME_DATA_PAIRS.forEach((pair, index) => {
                // Carta da Palavra
                cards.push({
                    id: `w-${index}`, 
                    content: pair.word, 
                    matchValue: pair.syllable,
                    type: 'word',
                    emoji: pair.emoji || '',
                    isFlipped: false,
                    isMatched: false
                });
                // Carta da S√≠laba
                cards.push({
                    id: `s-${index}`, 
                    content: pair.syllable, 
                    matchValue: pair.word,
                    type: 'syllable',
                    emoji: '',
                    isFlipped: false,
                    isMatched: false
                });
            });
            
            // 2. Embaralha todas as cartas (CARTAS E PARES EMBARALHADOS)
            cards = shuffleArray(cards);
            
            // 3. Reseta o estado do jogo
            memoryGameState = {
                cards: cards,
                flippedCards: [],
                lockBoard: false,
                matchesFound: 0
            };
        }

        function renderMemoryGame() {
            // Se o jogo n√£o foi inicializado ou foi finalizado, inicializa um novo
            if (memoryGameState.cards.length === 0 || memoryGameState.matchesFound === (memoryGameState.cards.length / 2)) {
                initializeMemoryGame();
            }
            
            app.innerHTML = `
                <h2 class="text-3xl font-bold text-teal-600 mb-6 text-center">üß© Jogo da Mem√≥ria Educativo</h2>
                <div class="flex justify-center mb-6">
                    <span id="score-display" class="text-2xl font-black text-yellow-600 border-b-4 border-yellow-400 pb-1"> ‚≠ê Pontos: ${playerScore} </span>
                </div>

                <div class="bg-teal-100 p-8 rounded-2xl border-4 border-teal-500 shadow-inner flex flex-col items-center mb-8">
                    <p class="text-xl text-gray-700 mb-6 font-semibold text-center">Encontre os pares de PALAVRA e S√çLABA INICIAL correspondentes!</p>
                    
                    <div id="memory-board" class="w-full max-w-4xl">
                        ${memoryGameState.cards.map(card => `
                            <div class="memory-card ${card.isFlipped ? 'flipped' : ''} ${card.isMatched ? 'matched' : ''}" 
                                data-card-id="${card.id}" 
                                onclick="flipCard('${card.id}')"
                                title="${card.type === 'word' ? 'Palavra' : 'S√≠laba'}"
                            >
                                <div class="card-inner">
                                    <div class="card-face card-front flex-col text-center">
                                        ${card.emoji && card.type === 'word' ? `<span class="text-xl">${card.emoji}</span>` : ''}
                                        <span class="text-3xl font-black" data-text="${card.content}">${card.content}</span>
                                    </div>
                                    <div class="card-face card-back">
                                        üß†
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="flex justify-between items-center mt-8 flex-wrap gap-4">
                    <button onclick="goToScreen('home')" class="py-3 px-6 bg-gray-500 text-white font-bold rounded-xl hover:bg-gray-600 transition-all duration-200 shadow-md">
                        üè† Menu
                    </button>
                    <button onclick="renderMemoryGame()" class="py-3 px-6 bg-teal-500 text-white font-bold rounded-xl hover:bg-teal-600 transition-all duration-200 shadow-md">
                        üîÑ Novo Jogo
                    </button>
                </div>
                <div class="mt-4 text-center text-sm text-gray-500">
                    Pares encontrados: <span class="font-bold text-teal-600">${memoryGameState.matchesFound}</span> de ${memoryGameState.cards.length / 2}
                </div>
            `;
        }

        function flipCard(id) {
            let state = memoryGameState;
            let card = state.cards.find(c => c.id === id);
            
            if (state.lockBoard || card.isFlipped || card.isMatched || state.flippedCards.length >= 2) return;

            card.isFlipped = true;
            state.flippedCards.push(card);
            
            const cardElement = document.querySelector(`[data-card-id="${id}"]`);
            if (cardElement) {
                cardElement.classList.add('flipped');
                // Tenta falar o conte√∫do
                playWordExample(card.content); 
            }

            if (state.flippedCards.length === 2) {
                state.lockBoard = true;
                checkForMatch();
            }
        }

        function checkForMatch() {
            let state = memoryGameState;
            const [card1, card2] = state.flippedCards;

            // Match se o valor de uma carta for o matchValue da outra, e vice-versa
            const isMatch = (card1.matchValue === card2.content) && (card2.matchValue === card1.content);

            if (isMatch) {
                // Match encontrado
                state.matchesFound++;
                card1.isMatched = true;
                card2.isMatched = true;
                
                const el1 = document.querySelector(`[data-card-id="${card1.id}"]`);
                const el2 = document.querySelector(`[data-card-id="${card2.id}"]`);
                if (el1) el1.classList.add('matched');
                if (el2) el2.classList.add('matched');
                
                updateScore(50);
                showFeedback(`üéâ Match! Palavra e S√≠laba Inicial! +50 pontos!`, 'green', 1500);
                
                resetBoard();
                
                if (state.matchesFound === state.cards.length / 2) {
                    showFeedback(`üèÜ Parab√©ns, ${playerName}! Voc√™ encontrou todos os pares! +100 pontos de b√¥nus!`, 'yellow', 3000);
                    updateScore(100);
                    setTimeout(() => renderMemoryGame(), 3000); 
                }

            } else {
                // N√£o √© um Match
                updateScore(-10);
                showFeedback(`‚ùå N√£o √© um par. Tente novamente! -10 pontos.`, 'red', 1000);

                setTimeout(() => {
                    card1.isFlipped = false;
                    card2.isFlipped = false;
                    
                    const el1 = document.querySelector(`[data-card-id="${card1.id}"]`);
                    const el2 = document.querySelector(`[data-card-id="${card2.id}"]`);
                    if (el1) el1.classList.remove('flipped');
                    if (el2) el2.classList.remove('flipped');
                    
                    resetBoard();
                }, 1200);
            }
        }

        function resetBoard() {
            memoryGameState.flippedCards = [];
            memoryGameState.lockBoard = false;
            
            const scoreDisplay = document.getElementById('score-display');
            if (scoreDisplay) {
                scoreDisplay.textContent = `‚≠ê Pontos: ${playerScore}`;
            }
            const matchCounter = document.querySelector('.font-bold.text-teal-600');
            if (matchCounter) {
                matchCounter.textContent = memoryGameState.matchesFound;
            }
        }


        // --- 9. RANKING ---
        function renderRanking() {
            const ranking = getRanking();
            
            app.innerHTML = `
                <h2 class="text-3xl font-bold text-yellow-600 mb-8 text-center">üèÜ Ranking dos Melhores</h2>
                <div class="flex justify-between items-center mb-6">
                    <span id="score-display" class="text-xl font-black text-yellow-600"> ‚≠ê Seus Pontos: ${playerScore} </span>
                    <button
                        onclick="goToScreen('home')"
                        class="py-2 px-4 bg-gray-400 text-white font-bold rounded-xl hover:bg-gray-500 transition-all duration-200"
                    >
                        Voltar
                    </button>
                </div>
                
                <div class="bg-yellow-50 p-6 rounded-2xl border-4 border-yellow-300 shadow-inner w-full max-w-xl mx-auto">
                    ${ranking.length > 0 ? `
                        <ol class="space-y-3">
                            ${ranking.map((item, index) => `
                                <li class="ranking-item p-4 bg-white rounded-xl shadow-md border-l-8 ${index === 0 ? 'border-amber-500' : index === 1 ? 'border-gray-400' : index === 2 ? 'border-amber-700' : 'border-yellow-200'} flex justify-between items-center">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-2xl font-black ${index === 0 ? 'text-amber-500' : index === 1 ? 'text-gray-500' : index === 2 ? 'text-amber-700' : 'text-gray-700'}">${index + 1}.</span>
                                        <span class="text-lg font-semibold text-gray-800">${item.name} ${item.name === playerName ? '(VOC√ä)' : ''}</span>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-xl font-extrabold text-blue-600">${item.score} pts</span>
                                        <p class="text-xs text-gray-500">em ${item.date}</p>
                                    </div>
                                </li>
                            `).join('')}
                        </ol>
                    ` : `
                        <p class="text-center text-lg text-gray-500 py-4">Nenhum jogador no ranking ainda. Seja o primeiro!</p>
                    `}
                </div>
            `;
        }

        // --- 10. MUDAR NOME/RESETAR ---
        function renderChangeName() {
            app.innerHTML = `
                <h2 class="text-3xl font-bold text-gray-600 mb-8 text-center">üîÑ Mudar Nome & Recome√ßar</h2>
                <div class="max-w-sm mx-auto p-6 bg-gray-50 rounded-xl shadow-lg border-2 border-gray-200 text-center">
                    <p class="text-lg text-gray-700 mb-4">Seu nome atual: <span class="font-extrabold">${playerName}</span></p>
                    <p class="text-lg text-gray-700 mb-6">Sua pontua√ß√£o atual: <span class="font-extrabold text-yellow-600">${playerScore}</span></p>
                    
                    <p class="text-md text-red-600 font-semibold mb-6">
                        Ao mudar seu nome, sua pontua√ß√£o atual ser√° salva no Ranking (se for uma das 10 melhores) e voc√™ recome√ßar√° com 0 pontos.
                    </p>

                    <h3 class="text-xl font-bold text-blue-500 mb-3">Novo Nome:</h3>
                    <input
                        type="text"
                        id="new-name-input"
                        placeholder="Digite o novo nome aqui"
                        maxlength="15"
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg text-center mb-6 focus:border-blue-500 transition-all duration-200"
                    />

                    <button
                        onclick="handleChangeNameConfirm()"
                        class="w-full py-3 px-6 bg-blue-500 text-white font-bold text-xl rounded-xl shadow-md hover:bg-blue-600 transition-all duration-200 mb-4"
                    >
                        Confirmar Mudan√ßa
                    </button>
                    
                    <button
                        onclick="goToScreen('home')"
                        class="w-full py-3 px-6 bg-gray-400 text-white font-bold text-xl rounded-xl shadow-md hover:bg-gray-500 transition-all duration-200"
                    >
                        Cancelar
                    </button>
                </div>
            `;
        }

        function handleChangeNameConfirm() {
            const input = document.getElementById('new-name-input');
            const newName = input.value.trim();
            if (newName.length > 1) {
                resetPlayerData(); // Salva o placar antigo e reseta o jogo
                updatePlayerName(newName); // Define o novo nome e zera o score
                showFeedback(`Nome alterado para ${newName}! Pontos resetados.`, 'green', 3000);
            } else {
                showFeedback('Por favor, digite um nome v√°lido.', 'red', 2000);
                input.classList.add('shake');
                setTimeout(() => input.classList.remove('shake'), 500);
            }
        }
        
        // --- INICIALIZA√á√ÉO ---
        function init() {
            // Adiciona listener para dragend (necess√°rio para soltar fora de um slot)
            document.addEventListener('dragend', dragEnd);
            
            if (playerName) {
                goToScreen('home');
            } else {
                goToScreen('welcome');
            }
        }
        
        window.onload = init;

    </script>
</body>
</html>
